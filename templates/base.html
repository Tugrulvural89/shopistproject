<!DOCTYPE html>
{% load staticfiles %}
<html>
   <head>
      <meta charset="UTF-8">
      <title>Title</title>
      <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
      <link rel="stylesheet" href="{% static 'css/homepage.css' %}">
   </head>
   <body>
      <nav class="navbar">
         <div class="activefirst">
            <a class="active" href="{% url 'HomePageView' %}"><i class="fa fa-home" aria-hidden="true"></i> Ana Sayfa</a>
            <a class="active" href="{% url 'campaign' %}"><i class="fa fa-flag-o" aria-hidden="true"></i> Kampanyalar</a>
            <a class="active" href="{% url 'index' %}" user=user.id><i class="fa fa-fw fa-search" aria-hidden="true"></i> Ürün Ara</a>
            <a class="active" href="{% url 'profilpage' %}" user=user.id><i class="fa fa-user-o" aria-hidden="true"></i> Ürünlerim</a>
         </div>
         <div class="navbarright">
            {% if user.is_authenticated %}
            <a href="#">Hi {{ user.username }}</a>
            <a href="{% url 'logout' %}">Log out</a>
            <a href="{% url 'profilpage' %}" user=user.id><i class="fa fa-user-o" aria-hidden="true"></i></a>
            {% else %}
            <a href="{% url 'signup' %}">Sign Up</a>
            <a href="{% url 'login' %}">Log In </a>
            <a href="#"><i class="fa fa-user-o" aria-hidden="true"></i></a>
            {% endif %}
            <a href="#"><i class="fa fa-fw fa-envelope"></i></a>
         </div>
      </nav>
      <form action="" class="searchform" method="post">
         {% csrf_token %}
         <div>
            <label for="id_your_name">Ürün Adı Girin:</label>
            <input style="width: 500px" type="text" value="koton kadın lacivert mont" name="your_name" maxlength="100" required="" id="id_your_name">
         </div>
         <div class="searchform-sites">
            <label>Hangi Site:</label>
            <span id="id_countries">
               <label for="id_countries_0"><input type="checkbox" name="countries" value="Boyner" id="id_countries_0">
               Boyner</label>
               <label for="id_countries_1"><input type="checkbox" name="countries" value="HM" id="id_countries_1">
               HM</label>
               <label for="id_countries_2"><input type="checkbox" name="countries" value="Trendyol" id="id_countries_2">
               Trendyol</label>
               <!--<label for="id_countries_3"><input type="checkbox" name="countries" value="Zara" id="id_countries_3">
                  Zara</label>-->
               <label for="id_countries_4"><input type="checkbox" name="countries" value="Morhipo" id="id_countries_4">
               Morhipo</label>
               <!--<label for="id_countries_5"><input type="checkbox" name="countries" value="Network" id="id_countries_5">
               Network</label>-->
               <label for="id_countries_6"><input type="checkbox" name="countries" value="Markafoni" id="id_countries_6">
               Markafoni</label>
            </span>
            <input type="submit" class="btn btn-primary" value="Ürün Ara">
         </div>
      </form>
      <div class="container">
         {% if form.is_valid %}
         <ul class="breadcrumb" style="margin: 20px;">
            <li class="breadcrumb-item"><a href="#">Arama</a></li>
            <li class="breadcrumb-item"><a href="#">Siteler</a></li>
            <li class="breadcrumb-item"><a href="#">Kelime</a></li>
            <li class="breadcrumb-item active"><strong>{{ form.your_name.value }}</strong> kelime aramanızda <strong>{{ newlist1|length }}
               sonuç bulundu</strong>
            </li>
         </ul>
         {% endif %}


            <div class="row">
               {% for object in newlist1 %}
               <div class="col-sm-4" style="display: grid;margin-top: 40px;text-align: center;">
                  <ul>
                     <li>
                        <div style="background-color:#ffffff;" class="w3-dropdown-hover">
                           <img src="{{ object.img }}" alt="Monterosso" style="width:50%;">
                           <div class="w3-dropdown-content" style="width:100px"><br>
                              <img src="{{ object.img }}" alt="Norway" style="width:200%">
                              <a href="{{ object.url }}" class="w3-border">Siteyi Ziyaret Et»</a>
                           </div>
                        </div>
                     </li>
                     <li>Satıldığı Site: <strong>{{ object.site }}</strong></li>
                     <li>Ürün Kodu: <strong>{{ object.serino }}</strong></li>
                     <li><span><strong>{{ object.title }}</strong></span></li>
                     <li><span><strong>{{ object.pricedisplay }} TL</strong></span></li>
                     <li><span><a target="_blank" href="{{ object.url }}"><strong>Ürünü sitesinde incelemek için TIKLA</strong></a></span></li>
                     <li>
                        <form method="post" action="" name="form1"  class="form1">
                           {% csrf_token %}
                           <input type="hidden" name="imageurl" value="{{ object.img }}"/>
                           <input type="hidden" name="keyword"  value="{{ form.your_name.value }}"/>
                           <input type="hidden" name="url"  value="{{ object.url }}"/>
                           <input type="hidden" name="site"  value="{{ object.site }}"/>
                           <input type="hidden" name="price"  value="{{ object.price }}"/>
                           <input type="hidden" name="title"  value="{{ object.title }}"/>
                           <input type="hidden" name="user" value="{{ request.user }}"/>
                           <input type="hidden" name="serino" value="{{ object.serino }}"/>
                           <input type="hidden" name="pricedisplay" value="{{ object.pricedisplay }}"/>
                           {% if object.serino not in denemes %}
                           <div class="exchange{{ object.serino }}"></div>
                           <button id="btn{{ object.serino }}" type="submit" class="btn btn-primary">Takip Et</button>
                           <script>
                              $(document).ready(function(){
                               $("#btn{{ object.serino }}").click(function(){
                                   $("#btn{{ object.serino }}").hide();
                                   $(".exchange{{ object.serino }}").html("<button id=\"btn{{ object.serino }}\" type=\"reset\" class=\"btn btn-primary\">takip edildi!</button>");
                               });
                              });
                           </script>
                           {% else %}
                           <button type="reset" class="btn btn-primary"><a href="{% url 'profilpage' %}" user=user.id>takip ediliyor</a></button>
                           {% endif %}
                        </form>
                     </li>
                  </ul>
               </div>
               {% endfor %}

         </div>


      </div>


   </body>

   <script type="text/javascript">
      $(document).ready(function () {
          var productForm = $(".form1")
          productForm.submit(function (event) {
              event.preventDefault();
              console.log("form is not sending")
              var thisForm = $(this)
              var actionEndpoint = thisForm.attr("action");
              var httpMethod = thisForm.attr("method");
              var formData = thisForm.serialize();

              $.ajax({

                  url: actionEndpoint,
                  method: httpMethod,
                  data: formData,


                  success: function (data) {
                      console.log("success")
                      console.log(data)

                  },

                  error: function (errorData) {
                      console.log("error")
                      console.log(errorData)

                  }
              })

          })

      })
   </script>
</html>
